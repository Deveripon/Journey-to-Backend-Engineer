# ЁЯЪА Node.js Cluster: Scaling Your Application

## ЁЯзР Cluster ржХрж┐? ржПржЯрж┐ ржХрж┐ржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рзЗ?

**Node.js** ржП cluster рж╣рж▓рзЛ ржПржХржЯрж╛ рж╕рзНржкрзЗрж╕рж╛рж▓ Node Module ржмрж╛ ржлрж┐ржЪрж╛рж░ред ржпрж╛ ржПржХржЯрж┐ рж╕рж╛рж░рзНржнрж╛рж░ ржХрзЗ ржорж╛рж▓рзНржЯрж┐ржкрж▓ рж╕рж╛рж░рзНржнрж╛рж░ ржЗржирзНрж╕ржЯрзЗржирзНрж╕ рж╣рж┐рж╕рзЗржмрзЗ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ ржпрж╛ржпрж╝ред

ржзрж░рж╛ ржпрж╛ржХ ржЖржорж╛ржжрзЗрж░ ржПржХржЯрж╛ Node.js рж╕рж╛рж░рзНржнрж╛рж░ ржЖржЫрзЗред ржПржЦржи ржЖржорж╛ржжрзЗрж░ ржЗржЙржЬрж╛рж░ рж╕ржВржЦрзНржпрж╛ ржЦрзБржм ржПржХржЯрж╛ ржмрзЗрж╢рж┐ ржирж╛ред рждрж╛рж╣рж▓рзЗ ржЖржорж╛ржжрзЗрж░ ржПржЗ ржПржХржЯрж╛ рж╕рж╛рж░рзНржнрж╛рж░ ржПрж░ рж╕ржм ржХрж┐ржЫрзБ ржкрж╛рж░ржлрзЗржХрзНржЯрж▓рж┐ ржорзНржпрж╛ржирзЗржЬ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗ ред ржХрж┐ржирзНрждрзБ ржпржжрж┐ ржПржоржи рж╣рзЯ ржпрзЗ ржЖржорж╛ржжрзЗрж░ ржПржкрзНрж▓рж┐ржХрзЗрж╢ржи ржЧрзНрж░рзЛ ржХрж░ржЫрзЗ ржПржмржВ ржЗржЙржЬрж╛рж░ ржмрж╛рзЬржЫрзЗ ржПржмржВ рж╕рзЗржЯрж╛ ржПржХрж╕ржорзЯ рж▓рж╛ржЦрзЗрж░ржУ ржмрзЗрж╢рж┐ рж╣рзЯрзЗ ржЧрзЗржЫрзЗ ред ржПржЦржи ржзрж░рж╛ ржпрж╛ржХ рззрзжрзжрзжрзж ржПрж░ ржмрзЗрж╢рж┐ ржЗржЙржЬрж╛рж░ ржПржХрж╕рж╛ржерзЗ ржЖржорж╛ржжрзЗрж░ рж╕рж╛рж░рзНржнрж╛рж░рзЗ рж░рж┐ржХрзБрзЯрзЗрж╕рзНржЯ ржХрж░рж▓рзЛ - рждржЦржи ржХрж┐ ржЖржорж╛ржжрзЗрж░ рж╕рзЗржЗ ржПржХржЯрж╛ рж╕рж╛рж░рзНржнрж╛рж░ рж╕рзЗржЗ рж░рж┐ржХрзБрзЯрзЗрж╕рзНржЯ рж╣рзНржпрж╛ржирзНржбрзЗрж▓ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗ ? ржЕржирзЗржХ ржХрзНрж╖рзЗрждрзНрж░рзЗржЗ ржкрж╛рж░ржмрзЗржирж╛ ржПржмржВ рж╕рж╛рж░рзНржнрж╛рж░ ржХрзНрж░рж╛рж╢ ржХрж░ржмрзЗ ред

рждрж╛ржЗ ржПржЗ ржЕржмрж╕рзНржерж╛ ржерзЗржХрзЗ ржЖржорж╛ржжрзЗрж░ рж╕рж┐рж╕рзНржЯрзЗржоржХрзЗ ржмрж╛ржБржЪрж╛рждрзЗ ржЖржорж░рж╛ ржЖржоржжрзЗрж░ рж╕рж╛рж░рзНржнрж╛рж░ржХрзЗ cluster ржПрж░ ржорж╛ржзрзНржпржорзЗ ржорж╛рж▓рзНржЯрж┐ржкрж▓ рж╕рж╛рж░рзНржнрж╛рж░ ржЗржирзНрж╕ржЯрзЗржирзНрж╕ рж╣рж┐рж╕рзЗржмрзЗ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржкрж╛рж░рж┐ред ржпрж╛рждрзЗ ржпржд ржмрзЗрж╢рж┐ рж░рж┐ржХрзБрзЯрзЗрж╕рзНржЯ ржЗ ржЖрж╕рзБржХ, ржЖржоржжрзЗрж░ ржорзЗржЗржи рж╕рж╛рж░рзНржнрж╛рж░ рж╕рзЗржЧрзБрж▓рзЛ ржмрж┐ржнрж┐ржирзНржи ржЗржирж╕рзНржЯрзНржпрж╛ржирзНрж╕рзЗ ржбрж┐рж╕рзНржЯрзНрж░рж┐ржмрж┐ржЙржЯ ржХрж░рзЗ ржжрж┐рзЯрзЗ рж▓рзЛржб ржмрзНржпрж╛рж▓рзЗржирзНрж╕рж┐ржВ ржХрж░рждрзЗ ржкрж╛рж░рзЗ ржПржмржВ ржЖржорж╛ржжрзЗрж░ рж╕рж╛рж░рзНржнрж╛рж░ ржХрзНрж░рж╛рж╢ ржирж╛ ржХрж░рзЗ ржмрж░ржВ ржкрж╛рж░ржлрзЗржХрзНржЯрж▓рж┐ рж╕рзНржХрзЗрж▓ ржХрж░рж╛ ржпрж╛рзЯред

---

## ЁЯЫая╕П How Cluster Works?

Node.js ржбрж┐ржлрж▓рзНржЯржнрж╛ржмрзЗ рж╕рж┐ржЩрзНржЧрзЗрж▓-ржерзНрж░рзЗржбрзЗржб (Single-threaded)ред ржЕрж░рзНржерж╛рзО ржПржЯрж┐ ржкрзНрж░рж╕рзЗрж╕рж░рзЗрж░ ржорж╛рждрзНрж░ ржПржХржЯрж┐ ржХрзЛрж░ (Core) ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗред ржЖржорж╛ржжрзЗрж░ ржХржорзНржкрж┐ржЙржЯрж╛рж░рзЗ ржпржжрж┐ рзоржЯрж╛ ржХрзЛрж░ ржерж╛ржХрзЗ, рждржмрзЗ ржПржХржЯрж┐ рж╕рж╛ржзрж╛рж░ржг Node.js ржЕрзНржпрж╛ржк ржорж╛рждрзНрж░ рззржЯрж┐ ржХрзЛрж░ ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЗ, ржмрж╛ржХрж┐ рзнржЯрж┐ ржХрзЛрж░ ржЕрж▓рж╕ ржмрж╕рзЗ ржерж╛ржХржмрзЗред

**Cluster Module** ржПржЗ рж╕ржорж╕рзНржпрж╛рж░ рж╕ржорж╛ржзрж╛ржи ржХрж░рзЗ:

1. **Master Process:** ржПржЯрж┐ ржорзЗржЗржи ржкрзНрж░рж╕рзЗрж╕ ржпрж╛ ржХржирзНржЯрзНрж░рзЛрж▓рж╛рж░рзЗрж░ ржорждрзЛ ржХрж╛ржЬ ржХрж░рзЗред ржПржЯрж┐ ржЕржирзНржпрж╛ржирзНржп ржкрзНрж░рж╕рзЗрж╕ржЧрзБрж▓рзЛ (Workers) рждрзИрж░рж┐ ржХрж░рзЗред
2. **Worker Process:** ржорж╛рж╕рзНржЯрж╛рж░ ржкрзНрж░рж╕рзЗрж╕ ржпрждржЧрзБрж▓рзЛ ржЗржЪрзНржЫрзЗ (рж╕рж╛ржзрж╛рж░ржгржд CPU ржХрзЛрж░ рж╕ржВржЦрзНржпрж╛ ржЕржирзБржпрж╛рзЯрзА) ржЪрж╛ржЗрж▓рзНржб ржкрзНрж░рж╕рзЗрж╕ рждрзИрж░рж┐ ржХрж░рждрзЗ ржкрж╛рж░рзЗред ржкрзНрж░рждрж┐ржЯрж┐ ржЪрж╛ржЗрж▓рзНржб ржкрзНрж░рж╕рзЗрж╕рзЗрж░ ржирж┐ржЬрж╕рзНржм ржЗржнрзЗржирзНржЯ рж▓рзБржк, ржорзЗржорзЛрж░рж┐ ржПржмржВ V8 ржЗржирзНрж╕ржЯрзЗржирзНрж╕ ржерж╛ржХрзЗред

![Cluster Illustration](/asset/cluster.png)

---

## ЁЯМЯ Benefits of Using Cluster

- **High Availability:** ржпржжрж┐ ржПржХржЯрж┐ ржУрзЯрж╛рж░рзНржХрж╛рж░ ржХрзЛржирзЛ ржХрж╛рж░ржгрзЗ ржХрзНрж░рж╛рж╢ ржХрж░рзЗ, ржмрж╛ржХрж┐ ржУрзЯрж╛рж░рзНржХрж╛рж░ржЧрзБрж▓рзЛ рж╕рж╛рж░рзНржнрж┐рж╕ ржжрж┐рзЯрзЗ ржпрзЗрждрзЗ ржкрж╛рж░рзЗред
- **Zero Downtime:** ржЕрзНржпрж╛ржк ржЖржкржбрзЗржЯ ржХрж░рж╛рж░ рж╕ржорзЯ ржПржХржЯрж┐ ржПржХржЯрж┐ ржХрж░рзЗ ржУрзЯрж╛рж░рзНржХрж╛рж░ рж░рж┐рж╕рзНржЯрж╛рж░рзНржЯ ржХрж░рж╛ ржпрж╛рзЯ, ржпрж╛рж░ ржлрж▓рзЗ рж╕рж╛рж░рзНржнрж┐рж╕ ржмржирзНржз рж╣рзЯ ржирж╛ред
- **Better Performance:** ржорж╛рж▓рзНржЯрж┐-ржХрзЛрж░ CPU ржПрж░ ржкрзВрж░рзНржг ржХрзНрж╖ржорждрж╛ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ ржпрж╛рзЯред
- **Load Balancing:** ржЗржиржХрж╛ржорж┐ржВ рж░рж┐ржХрзБрзЯрзЗрж╕рзНржЯржЧрзБрж▓рзЛ ржЕржЯрзЛржорзЗржЯрж┐ржХрзНржпрж╛рж▓рж┐ рж╕ржм ржУрзЯрж╛рж░рзНржХрж╛рж░рзЗрж░ ржоржзрзНржпрзЗ ржбрж┐рж╕рзНржЯрзНрж░рж┐ржмрж┐ржЙржЯ рж╣рзЯрзЗ ржпрж╛рзЯред

---

## ЁЯТ╗ Simple Implementation (Express.js)

```javascript
import cluster from 'cluster';
import express from 'express';
import os from 'os';

const numCPUs = os.cpus().length;

if (cluster.isPrimary) {
    console.log(`Primary cluster ${process.pid} is running`);

    // Fork workers based on CPU cores
    for (let i = 0; i < numCPUs; i++) {
        cluster.fork();
    }

    cluster.on('exit', worker => {
        console.log(`Worker ${worker.process.pid} died. Forking a new one...`);
        cluster.fork(); // Automatically restart a worker
    });
} else {
    const app = express();
    const port = 5000;

    app.get('/', (req, res) => {
        res.json({ message: `Response from Process ID: ${process.pid}` });
    });

    app.listen(port, () => {
        console.log(`Server running on port ${port} - PID: ${process.pid}`);
    });
}
```

---

## ЁЯУК Summary

Cluster ржмрзНржпржмрж╣рж╛рж░рзЗрж░ ржлрж▓рзЗ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржирзЗрж░ **Horizontal Scaling** ржХрж░рж╛ рж╕рж╣ржЬ рж╣рзЯ ржПржмржВ рж╣рзЗржнрж┐ ржЯрзНрж░рж╛ржлрж┐ржХ рж╣рзНржпрж╛ржирзНржбрзЗрж▓ ржХрж░рж╛рж░ ржХрзНрж╖ржорждрж╛ ржмрж╣рзБржЧрзБржг ржмрзЗрзЬрзЗ ржпрж╛рзЯред ржПржЯрж┐ ржорзВрж▓ржд ржкрзНрж░рзЛржбрж╛ржХрж╢ржи рж▓рзЗржнрзЗрж▓ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржирзЗрж░ ржЬржирзНржп ржПржХржЯрж┐ ржорж╛рж╕рзНржЯ-рж╣рзНржпрж╛ржн ржлрж┐ржЪрж╛рж░ред

